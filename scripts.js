$(document).ready(function(){var t,n,e=$(".screen"),i=$(".screen-home"),o=$(".screen-toc"),c=$(".screen-story"),s=i,r=0,u=0,a=!1,f=function(){},l=function(t,n){a||(n=n||f,a=!0,s.removeClass("screen-current").one("transitionend",function(){s=t,t.addClass("screen-current").one("transitionend",function(){n(),a=!1})}))},d=function(){$(".toc__item a",t).get(r).focus()};e.imagesLoaded(function(){t=$(".toc__grid",o).masonry({itemSelector:".toc__item",columnWidth:".toc__item--sizer",percentPosition:!0}),n=$(".carousel",c).flickity({pageDots:!1,prevNextButtons:!1}),$(".loading",i).removeClass("progress").text("entrer")}),$(document).on("keyup",function(t){13===t.which&&s===i&&l(o,d),27===t.which&&(s===c&&l(o,d),s===o&&l(i))}),i.on("click",".button",function(){l(o,d)}),o.on("click",".toc__item a",function(t){t.preventDefault(),$(this).focus();var e=$(this).data("goto");u=e,n.flickity("select",e,!1,!0),l(c,function(){n.focus()})}).on("focus",".toc__item a",function(){r=$(".toc__item a",o).index($(this))}),c.on("click",".story-close",function(){l(o,d)}),$(window).on("orientationchange",function(){c.css("visibility","hidden"),n.flickity("destroy"),n=$(".carousel",c).flickity({pageDots:!1,prevNextButtons:!1,initialIndex:u}),c.css("visibility","visible")})});